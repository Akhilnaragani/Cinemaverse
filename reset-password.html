<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reset Password - Cinemaverse</title>
  <link href="https://fonts.googleapis.com/css2?family=Electrolize&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="auth.js"></script>
  <style>
    body{margin:0; font-family:'Electrolize',sans-serif; background:#000; color:#fff;}
    .wrap{min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:20px;}
    .card{width:100%; max-width:420px; background:#111; border-radius:12px; padding:24px; box-shadow:0 8px 16px rgba(0,0,0,.6);}
    h1{margin:0 0 12px; color:#f00; text-align:center; font-size:28px;}
    p{margin:0 0 16px; color:#ddd; text-align:center;}
    input{width:100%; padding:12px; border:0; border-radius:6px; background:#222; color:#fff;}
    button{width:100%; margin-top:14px; padding:12px; border:0; border-radius:6px; background:#f00; color:#fff; font-weight:700; cursor:pointer;}
    button:hover{background:#c20000;}
    .msg{margin-top:12px; text-align:center; color:#9fe29f; display:none;}
    .err{margin-top:12px; text-align:center; color:#ff6b6b; display:none;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Set New Password</h1>
      <p>Enter a new password for your account.</p>
      <input id="new-pass" type="password" placeholder="New password (min 6 chars)" />
      <button id="update-btn">Update Password</button>
      <div id="ok" class="msg">Password updated. Redirectingâ€¦</div>
      <div id="er" class="err">Error</div>
    </div>
  </div>

  <script>
    (function initSupabase() {
      // If your auth.js already creates a global `supabase`, you can remove this and rely on that.
      if (!window.supabase && window.createSupabaseClient) {
        window.supabase = createSupabaseClient(); // optional helper from your auth.js
      }
    })();

    document.getElementById('update-btn')?.addEventListener('click', async () => {
      const ok = document.getElementById('ok');
      const er = document.getElementById('er');
      ok.style.display = 'none'; er.style.display = 'none';

      const pwd = document.getElementById('new-pass').value.trim();
      if (pwd.length < 6) { er.textContent='Password too short'; er.style.display='block'; return; }

      // When user lands here from email link, Supabase session is present (access token in URL).
      const { error } = await supabase.auth.updateUser({ password: pwd });

      if (error) { er.textContent = error.message; er.style.display='block'; return; }

      ok.style.display = 'block';
      setTimeout(() => { window.location.href = 'login.html'; }, 1200);
    });
  </script>
</body>
</html>
