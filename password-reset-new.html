<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cinemaverse – Reset Password</title>
  <link href="https://fonts.googleapis.com/css2?family=Electrolize&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Electrolize',sans-serif;background:#000;color:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0}
    .card{background:#111;padding:24px;border-radius:10px;max-width:360px;width:100%;box-shadow:0 6px 20px rgba(0,0,0,.5)}
    h1{color:#f00;font-size:1.4rem;margin:0 0 10px}
    p{color:#bbb;margin:0 0 16px}
    input,button{width:100%;padding:12px;border-radius:8px;border:1px solid #333;margin:8px 0}
    input{background:#000;color:#fff}
    button{background:#f00;color:#fff;border:none;font-weight:700;cursor:pointer}
    button:hover{opacity:.9}
    .msg{margin-top:10px;color:#9cf}
    .err{color:#f77}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="auth.js"></script> <!-- must create the supabase client -->
</head>
<body>
  <div class="card">
    <h1>Reset your password</h1>
    <p>Enter a new password for your account.</p>
    <input id="newpass" type="password" placeholder="New password" />
    <button id="setpass">Update Password</button>
    <div id="out" class="msg"></div>
  </div>

  <script>
    // On this page, the user arrives via Supabase recovery link (with a short-lived access token).
    // We just call updateUser with the new password.
    document.getElementById('setpass').addEventListener('click', async () => {
      const out = document.getElementById('out');
      out.textContent = '';

      const newpass = (document.getElementById('newpass').value || '').trim();
      if (newpass.length < 6) {
        out.textContent = 'Password must be at least 6 characters.';
        out.className = 'msg err';
        return;
      }

      try {
        const { data, error } = await supabase.auth.updateUser({ password: newpass });
        if (error) {
          out.textContent = 'Error: ' + error.message;
          out.className = 'msg err';
          return;
        }
        out.textContent = 'Password updated. Redirecting to login…';
        out.className = 'msg';
        setTimeout(() => location.href = 'login.html', 1200);
      } catch (e) {
        out.textContent = 'Unexpected error: ' + e.message;
        out.className = 'msg err';
      }
    });
  </script>
</body>
</html>
